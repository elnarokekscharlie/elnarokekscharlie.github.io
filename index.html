<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>FPS Elite: Curry Edition</title>
    <style>
        :root {
            --gsw-blue: #1D428A;
            --gsw-yellow: #FFC72C;
            --skin: #8d5524;
        }
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Segoe UI', monospace;
            background: #111;
            user-select: none;
            cursor: none; /* Скрываем курсор */
        }

        #scene {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: radial-gradient(circle at center, #2b2b2b 0%, #000 100%);
            overflow: hidden;
            perspective: 1200px; /* Глубина 3D */
        }

        /* HUD (Интерфейс) */
        #hud {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #00ff00;
            font-size: 24px;
            z-index: 100;
            text-shadow: 0 0 8px rgba(0, 255, 0, 0.8);
            font-weight: bold;
            pointer-events: none;
        }

        /* Пол (Сетка) */
        #floor {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 50%;
            background: 
                linear-gradient(rgba(30,30,30,0.9), #000),
                repeating-linear-gradient(
                90deg, transparent 0, transparent 49px, rgba(0, 255, 0, 0.1) 50px
                ),
                repeating-linear-gradient(
                0deg, transparent 0, transparent 49px, rgba(0, 255, 0, 0.1) 50px
                );
            transform-origin: bottom;
            transform: rotateX(60deg) scale(2);
            z-index: 1;
        }

        /* === МАНЕКЕН (ЦЕЛЬ) === */
        #mannequin {
            position: absolute;
            top: 50%;
            left: 35%; /* По умолчанию слева от центра */
            transform: translate(-50%, -50%);
            z-index: 10;
            width: 100px;
            height: 240px;
            transition: filter 0.05s;
            /* Увеличенный хитбокс через прозрачную рамку, если нужно, но JS теперь умнее */
        }
        /* Детали манекена */
        .m-part { position: absolute; background: #ccc; border: 1px solid #999; box-shadow: inset 0 0 10px rgba(0,0,0,0.2); }
        
        .m-head {
            top: 0; left: 50%; transform: translateX(-50%);
            width: 50px; height: 60px; border-radius: 50% 50% 40% 40%;
            background: radial-gradient(circle at 30% 30%, #e0e0e0, #bbb);
        }
        /* Красная точка на лбу/груди для прицеливания */
        .m-head::after {
            content: ''; position: absolute; top: 40%; left: 50%; transform: translate(-50%,-50%);
            width: 10px; height: 10px; background: #ff0000; border-radius: 50%;
            box-shadow: 0 0 5px red;
        }
        
        .m-neck { top: 58px; left: 50%; transform: translateX(-50%); width: 25px; height: 15px; background: #aaa; }
        
        .m-torso {
            top: 70px; left: 50%; transform: translateX(-50%);
            width: 80px; height: 100px; border-radius: 10px 10px 5px 5px;
            background: linear-gradient(to bottom, #ddd, #bbb);
        }
        .m-torso::before { /* Грудные мышцы */
            content: ''; position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            width: 70px; height: 30px; background: rgba(0,0,0,0.05); border-radius: 5px;
        }

        .m-arm { width: 20px; height: 90px; border-radius: 5px; top: 75px; background: #ccc; }
        .m-arm.left { left: -5px; transform: rotate(5deg); }
        .m-arm.right { right: -5px; transform: rotate(-5deg); }

        .m-leg { width: 25px; height: 100px; border-radius: 5px; top: 165px; background: #bbb; }
        .m-leg.left { left: 10px; }
        .m-leg.right { right: 10px; }


        /* === БАСКЕТБОЛ (СПРАВА) === */
        
        /* Кольцо */
        #hoop-complex {
            position: absolute;
            top: 25%;
            right: 10%;
            z-index: 5;
            transform: scale(1.3);
        }
        .hoop-stand {
            position: absolute;
            bottom: -300px; right: 40px;
            width: 15px; height: 400px;
            background: #444; border-left: 3px solid #222;
        }
        .hoop-backboard {
            position: relative;
            width: 140px; height: 95px;
            background: rgba(255,255,255,0.9);
            border: 2px solid #ccc; border-bottom: 4px solid #999;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }
        .hoop-square {
            position: absolute; bottom: 15px; left: 50%; transform: translateX(-50%);
            width: 50px; height: 40px;
            border: 3px solid #c00;
        }
        .hoop-rim {
            position: absolute; bottom: 5px; left: 50%; transform: translateX(-50%);
            width: 60px; height: 4px; background: #ff6f00;
            border-radius: 2px; z-index: 6;
        }
        /* Передняя часть кольца (для эффекта пролетания мяча) */
        .hoop-rim-front {
            position: absolute; bottom: -20px; left: 50%; transform: translateX(-50%);
            width: 60px; height: 25px; 
            border: 4px solid #ff6f00; border-top: none;
            border-radius: 0 0 30px 30px;
            z-index: 20; /* Поверх мяча, когда он падает */
        }
        .hoop-net {
            position: absolute; bottom: -55px; left: 50%; transform: translateX(-50%);
            width: 50px; height: 50px;
            background: 
                linear-gradient(45deg, transparent 45%, #eee 45%, #eee 55%, transparent 55%),
                linear-gradient(-45deg, transparent 45%, #eee 45%, #eee 55%, transparent 55%);
            background-size: 10px 10px;
            clip-path: polygon(0 0, 100% 0, 80% 100%, 20% 100%);
            opacity: 0.8;
            z-index: 4;
        }

        /* СТЕФАН КАРРИ (реалистичная модель) */
        #curry-wrapper {
            position: absolute;
            bottom: 20%; /* Стоит на полу */
            right: 20%;
            width: 80px; height: 200px;
            z-index: 8;
        }
        .c-body { position: absolute; }
        
        .c-head {
            top: 0; left: 20px; width: 35px; height: 40px;
            background: var(--skin); border-radius: 10px;
            z-index: 3;
        }
        .c-beard {
            position: absolute; bottom: 0; width: 100%; height: 15px;
            background: #3e2723; border-radius: 0 0 10px 10px;
        }

        .c-jersey {
            top: 40px; left: 10px; width: 55px; height: 70px;
            background: var(--gsw-blue);
            border-radius: 10px 10px 0 0;
            z-index: 2;
            display: flex; justify-content: center; align-items: center;
            color: var(--gsw-yellow); font-weight: bold; font-size: 18px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
        }
        .c-shorts {
            top: 105px; left: 10px; width: 55px; height: 50px;
            background: var(--gsw-blue);
            border-top: 2px solid var(--gsw-yellow);
            z-index: 1;
        }
        /* Полоски по бокам */
        .c-shorts::before, .c-shorts::after {
            content: ''; position: absolute; top: 0; width: 4px; height: 100%; background: var(--gsw-yellow);
        }
        .c-shorts::after { right: 0; }

        .c-leg {
            position: absolute; width: 15px; height: 60px;
            background: var(--skin); bottom: -15px;
        }
        .c-leg.l { left: 15px; }
        .c-leg.r { right: 15px; }
        
        /* Руки с анимацией */
        .c-arm {
            position: absolute; top: 45px; width: 12px; height: 70px;
            background: var(--skin); z-index: 4;
            transform-origin: top center;
            transition: transform 0.2s;
        }
        .c-arm.l { left: 5px; transform: rotate(10deg); }
        .c-arm.r { right: 5px; transform: rotate(-10deg); }

        /* Мяч */
        .ball {
            position: absolute; width: 24px; height: 24px;
            background: radial-gradient(circle at 35% 35%, #ff8800, #d35400);
            border-radius: 50%; border: 1px solid #a04000;
            z-index: 100;
        }
        /* Линии на мяче */
        .ball::before {
            content: ''; position: absolute; width: 100%; height: 100%;
            border: 1px solid rgba(0,0,0,0.3); border-radius: 50%;
            clip-path: polygon(0 0, 100% 0, 100% 100%, 50% 50%);
        }


        /* === ОРУЖИЕ (FPS) === */
        #weapon-rig {
            position: absolute; bottom: -10px; right: 30%;
            width: 300px; height: 400px;
            pointer-events: none; z-index: 90;
            transition: transform 0.08s ease-out;
        }
        .gun-body {
            position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
            width: 60px; height: 350px;
            background: linear-gradient(90deg, #111, #333, #111);
            border-radius: 5px 5px 0 0;
        }
        .gun-rail {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            width: 10px; height: 350px; background: #000;
        }
        #muzzle-flash {
            position: absolute; top: -60px; left: 50%; transform: translateX(-50%);
            width: 120px; height: 120px;
            background: radial-gradient(closest-side, #fff, #ffeb3b, transparent);
            opacity: 0; mix-blend-mode: screen;
        }

        /* Прицел */
        #crosshair {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 24px; height: 24px; pointer-events: none; z-index: 200;
        }
        .ch-line { position: absolute; background: #0f0; box-shadow: 0 0 4px #0f0; }
        .ch-h { top: 11px; left: 0; width: 24px; height: 2px; }
        .ch-v { top: 0; left: 11px; width: 2px; height: 24px; }
        .ch-dot { top: 10px; left: 10px; width: 4px; height: 4px; background: red; border-radius: 50%; }

        /* Дырка от пули */
        .bullet-hole {
            position: absolute; width: 8px; height: 8px;
            background: #111; border-radius: 50%;
            box-shadow: 0 0 0 1px rgba(255,255,255,0.3);
            pointer-events: none;
        }
    </style>
</head>
<body>

<div id="scene">
    <div id="hud">
        SCORE: <span id="score">0</span><br>
        3-POINTERS: <span id="threes">0</span>
    </div>
    
    <div id="floor"></div>

    <!-- МАНЕКЕН -->
<!-- ФОТО ВМЕСТО МАНЕКЕНА -->
<div id="mannequin" style="width: auto; height: auto; background: none;">
    <!-- Вставьте ссылку на ваше фото в src="..." -->
    <img src="https://th-i.thgim.com/public/news/national/qdvjbx/article70046755.ece/alternates/FREE_1200/charlie%20kirk_Art.jpg" 
         style="width: 150px; height: auto; pointer-events: none; user-select: none; display: block;">
</div>

    <!-- КОЛЬЦО -->
    <div id="hoop-complex">
        <div class="hoop-stand"></div>
        <div class="hoop-backboard">
            <div class="hoop-square"></div>
        </div>
        <div class="hoop-rim"></div>
        <div class="hoop-net"></div>
        <div class="hoop-rim-front"></div> <!-- Передняя дуга для объема -->
    </div>

    <!-- СТЕФАН КАРРИ -->
    <div id="curry-wrapper">
        <div class="c-body c-head"><div class="c-beard"></div></div>
        <div class="c-body c-jersey">30</div>
        <div class="c-body c-shorts"></div>
        <div class="c-body c-leg l"></div>
        <div class="c-body c-leg r"></div>
        <div class="c-arm l"></div>
        <div class="c-arm r"></div>
    </div>

    <!-- ОРУЖИЕ -->
    <div id="weapon-rig">
        <div class="gun-body"><div class="gun-rail"></div></div>
        <div id="muzzle-flash"></div>
    </div>
    
    <div id="crosshair">
        <div class="ch-line ch-h"></div>
        <div class="ch-line ch-v"></div>
        <div class="ch-line ch-dot"></div>
    </div>
</div>

<script>
    // === ПЕРЕМЕННЫЕ ===
    const scene = document.getElementById('scene');
    const weapon = document.getElementById('weapon-rig');
    const flash = document.getElementById('muzzle-flash');
    const mannequin = document.getElementById('mannequin');
    const scoreEl = document.getElementById('score');
    const threesEl = document.getElementById('threes');
    
    const curry = document.getElementById('curry-wrapper');
    const armL = document.querySelector('.c-arm.l');
    const armR = document.querySelector('.c-arm.r');
    
    let score = 0;
    let threes = 0;

    // === УПРАВЛЕНИЕ ОРУЖИЕМ (Параллакс) ===
    document.addEventListener('mousemove', (e) => {
        const xPct = (e.clientX / window.innerWidth) - 0.5;
        const yPct = (e.clientY / window.innerHeight) - 0.5;
        
        // Оружие наклоняется за мышью
        weapon.style.transform = `
            translateX(${xPct * 100}px) 
            translateY(${yPct * 40}px) 
            rotateY(${xPct * 15}deg) 
            rotateX(${-yPct * 10}deg)
        `;
        
        // Прицел следует точно за курсором
        const ch = document.getElementById('crosshair');
        ch.style.left = e.clientX + 'px';
        ch.style.top = e.clientY + 'px';
    });

    // === СТРЕЛЬБА ===
    document.addEventListener('mousedown', (e) => {
        shoot(e.clientX, e.clientY);
    });

    function shoot(x, y) {
        playAudio(800, 'sawtooth', 0.1); // Звук

        // Анимация отдачи
        const currentTransform = weapon.style.transform;
        weapon.style.transform = currentTransform + " translateY(20px) scale(0.95)";
        setTimeout(() => {
            weapon.style.transform = currentTransform; // Возврат
        }, 50);

        // Вспышка
        flash.style.opacity = 1;
        setTimeout(() => flash.style.opacity = 0, 50);

        // === УЛУЧШЕННЫЕ ХИТБОКСЫ ===
        // Получаем координаты манекена
        const rect = mannequin.getBoundingClientRect();
        
        // Расширяем зону попадания (Padding)
        const hitPadding = 20; 
        
        // Проверяем, попадает ли клик в прямоугольник манекена
        if (
            x >= rect.left - hitPadding && 
            x <= rect.right + hitPadding && 
            y >= rect.top - hitPadding && 
            y <= rect.bottom + hitPadding
        ) {
            hitMannequin(x, y, rect);
        }
    }

    function hitMannequin(x, y, rect) {
        score += 50;
        scoreEl.innerText = score;

        // Создаем дырку (относительно манекена)
        const hole = document.createElement('div');
        hole.className = 'bullet-hole';
        // Ограничиваем дырки внутри визуальной части
        const relX = Math.max(0, Math.min(x - rect.left, rect.width));
        const relY = Math.max(0, Math.min(y - rect.top, rect.height));
        
        hole.style.left = relX + 'px';
        hole.style.top = relY + 'px';
        mannequin.appendChild(hole);

        // Эффект попадания (Красный блик)
        mannequin.style.filter = 'brightness(1.5) sepia(1) hue-rotate(-50deg) saturate(5)';
        mannequin.style.transform = 'translate(-50%, -50%) scale(0.95)'; // Дергается
        
        setTimeout(() => {
            mannequin.style.filter = 'none';
            mannequin.style.transform = 'translate(-50%, -50%) scale(1)';
        }, 80);

        // Респаун после 5 попаданий
        if (mannequin.children.length > 12) { // 7 частей тела + 5 дырок
            setTimeout(respawnMannequin, 200);
        }
    }

    function respawnMannequin() {
        // Удаляем дырки
        const holes = document.querySelectorAll('.bullet-hole');
        holes.forEach(h => h.remove());
        
        // Случайное место (20% - 60% ширины, 30% - 70% высоты)
        const rX = 20 + Math.random() * 40;
        const rY = 30 + Math.random() * 40;
        
        mannequin.style.left = rX + '%';
        mannequin.style.top = rY + '%';
    }

    // === БАСКЕТБОЛ (ФИЗИКА БРОСКА) ===
    setInterval(throwBall, 2500);

    function throwBall() {
        // 1. Анимация броска (Стеф Карри)
        // Присед
        curry.style.transform = 'translateY(10px)';
        armL.style.transform = 'rotate(40deg)'; // Поднимает руки
        armR.style.transform = 'rotate(0deg)';
        
        setTimeout(() => {
            // Прыжок и выпрямление рук
            curry.style.transform = 'translateY(-20px)';
            armL.style.transform = 'rotate(130deg)'; // Руки вверх
            armR.style.transform = 'rotate(110deg)';
            
            // Создаем мяч в руках
            createBall();
            
            // Возврат в стойку
            setTimeout(() => {
                curry.style.transform = 'translateY(0)';
                armL.style.transform = 'rotate(10deg)';
                armR.style.transform = 'rotate(-10deg)';
            }, 400);
        }, 300);
    }

    function createBall() {
        const ball = document.createElement('div');
        ball.className = 'ball';
        scene.appendChild(ball);

        // Координаты старта (руки Карри)
        const startRect = curry.getBoundingClientRect();
        const startX = startRect.left + 10;
        const startY = startRect.top;

        // Координаты кольца (цель)
        const hoopRect = document.querySelector('.hoop-rim').getBoundingClientRect();
        const targetX = hoopRect.left + (hoopRect.width / 2) - 12; // Центр кольца (-пол мяча)
        const targetY = hoopRect.top;

        // === МАТЕМАТИКА ПОЛЕТА (Квадратичная кривая Безье) ===
        let progress = 0;
        const duration = 900; // мс
        const startTime = performance.now();

        // Контрольная точка для дуги (высоко над кольцом)
        const controlX = (startX + targetX) / 2 - 50; // Чуть ближе к кольцу
        const controlY = targetY - 300; // Высота дуги

        function animateBall(time) {
            const elapsed = time - startTime;
            progress = elapsed / duration;

            if (progress > 1) {
                // Мяч долетел
                ball.remove();
                scoreThree();
                return;
            }

            // Формула кривой Безье (B(t) = (1-t)^2*P0 + 2(1-t)t*P1 + t^2*P2)
            const t = progress;
            
            const x = Math.pow(1-t, 2) * startX + 
                      2 * (1-t) * t * controlX + 
                      Math.pow(t, 2) * targetX;
            
            const y = Math.pow(1-t, 2) * startY + 
                      2 * (1-t) * t * controlY + 
                      Math.pow(t, 2) * targetY;

            // Масштабирование (мяч улетает вглубь)
            const scale = 1 - (t * 0.4); // Уменьшается до 0.6
            
            ball.style.left = x + 'px';
            ball.style.top = y + 'px';
            ball.style.transform = `scale(${scale})`;

            requestAnimationFrame(animateBall);
        }
        requestAnimationFrame(animateBall);
    }

    function scoreThree() {
        threes++;
        threesEl.innerText = threes;
        
        // Анимация сетки
        const net = document.querySelector('.hoop-net');
        net.style.transform = 'translateX(-50%) scaleY(1.3)'; // Растягивается
        setTimeout(() => net.style.transform = 'translateX(-50%) scaleY(1)', 200);
    }

    // === АУДИО ===
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playAudio(freq, type, vol) {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.1);
        gain.gain.setValueAtTime(vol, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.1);
    }
</script>
</body>
</html>
